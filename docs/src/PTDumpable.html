<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
    Module:     PTDumpable
    Copyright:  (c) T. N. Hayashi, 2019
    License:    Undetermined

    Provide an type class type of which 
    supports pretty serialization in the munge-trees style, 
    comparable to the Show class in Prelude.
-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PTDumpable</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>    </span><span class="hs-comment">-- * Types</span><span>
</span><a name="line-14"></a><span>    </span><a href="PTDumpable.html#TreeStyle"><span class="hs-identifier hs-type">TreeStyle</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="PTDumpable.html#NodeStyle"><span class="hs-identifier hs-type">NodeStyle</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- * Classes</span><span>
</span><a name="line-18"></a><span>    </span><a href="PTDumpable.html#Dumpable"><span class="hs-identifier hs-type">Dumpable</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Char</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">DC</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">DT</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">DTL</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy.Builder</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">DTLB</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- | 'TreeStyle' specifies the serialization style of trees.</span><span>
</span><a name="line-27"></a><span class="hs-keyword">data</span><span> </span><a name="TreeStyle"><a href="PTDumpable.html#TreeStyle"><span class="hs-identifier">TreeStyle</span></a></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="OneLine"><a href="PTDumpable.html#OneLine"><span class="hs-identifier">OneLine</span></a></a><span> </span><span class="hs-comment">-- ^ Each tree is serialized in one line.</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Pretty"><a href="PTDumpable.html#Pretty"><span class="hs-identifier">Pretty</span></a></a><span>  </span><span class="hs-comment">-- ^ Each tree is serialized prettily in the same way of munge-trees.</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">-- | 'NodeStyle' speficies the serialized style of node labels.</span><span>
</span><a name="line-33"></a><span class="hs-keyword">data</span><span> </span><a name="NodeStyle"><a href="PTDumpable.html#NodeStyle"><span class="hs-identifier">NodeStyle</span></a></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Minimal"><a href="PTDumpable.html#Minimal"><span class="hs-identifier">Minimal</span></a></a><span> </span><span class="hs-comment">-- ^ Each node is serialized as short as is possible.</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Default"><a href="PTDumpable.html#Default"><span class="hs-identifier">Default</span></a></a><span> </span><span class="hs-comment">-- ^ Each node is serialized normally.</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Full"><a href="PTDumpable.html#Full"><span class="hs-identifier">Full</span></a></a><span>    </span><span class="hs-comment">-- ^ Each node is serialized with full information.</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- | 'Option' bundles all the serialization options mentioned above.</span><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="Option"><a href="PTDumpable.html#Option"><span class="hs-identifier">Option</span></a></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Option"><a href="PTDumpable.html#Option"><span class="hs-identifier">Option</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-42"></a><span>        </span><span class="hs-comment">-- | The serialization style of tree structures.</span><span>
</span><a name="line-43"></a><span>        </span><a name="treeStyle"><a href="PTDumpable.html#treeStyle"><span class="hs-identifier">treeStyle</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="PTDumpable.html#TreeStyle"><span class="hs-identifier hs-type">TreeStyle</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><span class="hs-comment">-- | The serialization style of nodes.</span><span>
</span><a name="line-45"></a><span>        </span><a name="nodeStyle"><a href="PTDumpable.html#nodeStyle"><span class="hs-identifier">nodeStyle</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="PTDumpable.html#NodeStyle"><span class="hs-identifier hs-type">NodeStyle</span></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | 'Dumpable' is a class of types which support the</span><span>
</span><a name="line-49"></a><span class="hs-comment">--      munge-trees style serialization of trees.</span><span>
</span><a name="line-50"></a><span class="hs-comment">--      A tree is serialized with 'Data.Text.Lazy.Builder',</span><span>
</span><a name="line-51"></a><span class="hs-comment">--          which needs further conversion to Data.Text or others.</span><span>
</span><a name="line-52"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679025775"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Dumpable"><a href="PTDumpable.html#Dumpable"><span class="hs-identifier">Dumpable</span></a></a><span> </span><a name="local-6989586621679025775"><a href="#local-6989586621679025775"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- | Serialize a tree with options.</span><span>
</span><a name="line-54"></a><span>    </span><a name="psdDump"><a href="PTDumpable.html#psdDump"><span class="hs-identifier">psdDump</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-type">Option</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679025775"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DTLB.Builder</span><span>
</span><a name="line-55"></a><span>    </span><a name="local-8214565720323800673"><a href="PTDumpable.html#psdDump"><span class="hs-identifier">psdDump</span></a></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="PTDumpable.html#Default"><span class="hs-identifier hs-var">Default</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- &#26222;&#27573;&#36963;&#12356;</span><span>
</span><a name="line-56"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DTLB.fromString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-57"></a><span>            </span><span class="hs-comment">-- default&#12391;&#12399;show&#12392;&#21516;&#12376;&#12384;&#12364;&#12289;&#12418;&#12387;&#12392;&#21177;&#29575;&#12398;&#12424;&#12356;&#12418;&#12398;&#12364;&#12354;&#12387;&#12390;&#12418;&#27083;&#12431;&#12394;&#12356;</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-identifier">psdDump</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="PTDumpable.html#psdDump"><span class="hs-identifier hs-var">psdDump</span></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="PTDumpable.html#Default"><span class="hs-identifier hs-var">Default</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>            </span><span class="hs-comment">-- default&#12391;&#12399;Pretty Default&#12392;&#21516;&#12376;</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-identifier">psdDump</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#OneLine"><span class="hs-identifier hs-var">OneLine</span></a><span> </span><a name="local-6989586621679026721"><a href="#local-6989586621679026721"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- oneLine</span><span>
</span><a name="line-62"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DTLB.fromLazyText</span><span>
</span><a name="line-63"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DTL.filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679026722"><a href="#local-6989586621679026722"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679026722"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">DTLB.toLazyText</span><span>
</span><a name="line-65"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><a href="PTDumpable.html#psdDump"><span class="hs-identifier hs-var">psdDump</span></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="#local-6989586621679026721"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-comment">-- | Serialized a tree with the default option.</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-comment">--       * 'PTDumpable.treeStyle': 'PTDumpable.Pretty'</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-comment">--       * 'PTDumpable.nodeStyle': 'PTDumpable.Default'</span><span>
</span><a name="line-70"></a><span>    </span><a name="psdDumpDefault"><a href="PTDumpable.html#psdDumpDefault"><span class="hs-identifier">psdDumpDefault</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679025775"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DTLB.Builder</span><span>
</span><a name="line-71"></a><span>    </span><a name="local-8214565720323800674"><a href="PTDumpable.html#psdDumpDefault"><span class="hs-identifier">psdDumpDefault</span></a></a><span>
</span><a name="line-72"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="PTDumpable.html#psdDump"><span class="hs-identifier hs-var">psdDump</span></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="PTDumpable.html#Default"><span class="hs-identifier hs-var">Default</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">instance</span><span> </span><a href="PTDumpable.html#Dumpable"><span class="hs-identifier hs-type">Dumpable</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-keyword">instance</span><span> </span><a href="PTDumpable.html#Dumpable"><span class="hs-identifier hs-type">Dumpable</span></a><span> </span><span class="hs-identifier hs-type">DT.Text</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-77"></a><span>    </span><a name="local-8214565720323800673"><a href="PTDumpable.html#psdDump"><span class="hs-identifier">psdDump</span></a></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DTLB.fromText</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier">psdDump</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#OneLine"><span class="hs-identifier hs-var">OneLine</span></a><span> </span><a name="local-6989586621679030750"><a href="#local-6989586621679030750"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#psdDump"><span class="hs-identifier hs-var">psdDump</span></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="#local-6989586621679030750"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DT.filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679030751"><a href="#local-6989586621679030751"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679030751"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">instance</span><span> </span><a href="PTDumpable.html#Dumpable"><span class="hs-identifier hs-type">Dumpable</span></a><span> </span><span class="hs-identifier hs-type">DTL.Text</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>    </span><a name="local-8214565720323800673"><a href="PTDumpable.html#psdDump"><span class="hs-identifier">psdDump</span></a></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DTLB.fromLazyText</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-identifier">psdDump</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#OneLine"><span class="hs-identifier hs-var">OneLine</span></a><span> </span><a name="local-6989586621679030656"><a href="#local-6989586621679030656"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#psdDump"><span class="hs-identifier hs-var">psdDump</span></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><a href="#local-6989586621679030656"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DTL.filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679030657"><a href="#local-6989586621679030657"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679030657"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-keyword">instance</span><span> </span><a href="PTDumpable.html#Dumpable"><span class="hs-identifier hs-type">Dumpable</span></a><span> </span><span class="hs-identifier hs-type">DTLB.Builder</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>    </span><a name="local-8214565720323800673"><a href="PTDumpable.html#psdDump"><span class="hs-identifier">psdDump</span></a></a><span> </span><span class="hs-special">(</span><a href="PTDumpable.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><a href="PTDumpable.html#Pretty"><span class="hs-identifier hs-var">Pretty</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span></pre></body></html>